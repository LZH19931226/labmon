<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hc.infrastructure.dao.EquipmentInfoDao">


    <select id="batchGetEquipmentInfo" resultType="com.hc.dto.MonitorEquipmentDto">
        select
            t1.*,
            t2.sn
        from
            monitorequipment t1
        left join  monitorinstrument t2 on t1.equipmentno = t2.equipmentno
        where t1.equipmentno in
        <foreach collection="equipmentNoList" item="eqNo" index="index" open="(" separator="," close=")">
            #{eqNo}
        </foreach>
    </select>

    <select id="getAll" resultType="com.hc.dto.MonitorEquipmentDto">
        select
            t1.*,
            t2.instrumentno,
            t2.sn
        from
            monitorequipment t1
        left join monitorinstrument t2 on t1.equipmentno = t2.equipmentno
    </select>

    <select id="getEquipmentInfoByPage" resultType="com.hc.dto.MonitorEquipmentDto">
        select
        t1.*
        from
        monitorequipment t1
        where t1.clientvisible = '1' and t1.hospitalcode = #{probeCommand.hospitalCode}
          and t1.equipmenttypeid = #{probeCommand.equipmentTypeId}
        <if test = "probeCommand.warningSwitch != null and probeCommand.warningSwitch != ''">
            <if test = 'probeCommand.warningSwitch == 0'>
                and (t1.warning_switch = #{probeCommand.warningSwitch}  or  t1.warning_switch IS NULL)
            </if>
            <if test = 'probeCommand.warningSwitch == 1'>
                and t1.warning_switch = #{probeCommand.warningSwitch}
            </if>
        </if>
        <if test = "probeCommand.equipmentName != null and probeCommand.equipmentName != ''">
            and t1.equipmentname like concat('%',#{probeCommand.equipmentName},'%')
        </if>
        <if test="probeCommand.state != null and probeCommand.state != ''">
            and t1.state = #{probeCommand.state}
        </if>
        ORDER BY equipmentname
    </select>
</mapper>
